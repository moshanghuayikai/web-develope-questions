<h2 id="3.1">Node.js</h2>


#### node.jsç›¸å…³

> Node.jsä¹‹æ‰€ä»¥æ˜¯ä¸€ä¸ªå‡ºè‰²çš„æ¡†æ¶ï¼ŒåŸºäºä¸‹é¢å‡ ä¸ªåŸå› ï¼š


```
  JavaScriptç«¯åˆ°ç«¯ï¼šå¯ä»¥ç”¨JavaScriptåŒæ—¶ç¼–å†™æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯è„šæœ¬ã€‚

  äº‹ä»¶é©±åŠ¨çš„å¯æ‰©å±•æ€§ï¼šNode.jsåº”ç”¨æ—¶é—´æ¨¡å‹åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸Šæ¥å¤„ç†Webè¯·æ±‚ã€‚

  å¯æ‰©å±•æ€§ï¼šNode.jsè¿½éšè€…å¤šã€ç¤¾åŒºæ´»è·ƒã€å®‰è£…æ–°æ¨¡å—ç®€å•

  å¿«é€Ÿæ‰§è¡Œï¼šå»ºç«‹Node.jsï¼Œå¹¶åœ¨å…¶ä¸­å¼€å‘æ—¶è¶…çº§å®¹æ˜“çš„ã€‚

```



> Node.jsçš„äº‹ä»¶æ¨¡å‹ã€å®šæ—¶å™¨ã€å‘å°„å™¨ã€ç›‘å¬å™¨å’Œå›è°ƒå‡½æ•°

```

```



> Node.jsçš„Bufferã€æµã€I/O

```

```



> å¦‚ä½•å®ç°ä¸€ä¸ªWritableã€Readableã€Duplexæµï¼Ÿ

```

```



> ä»€ä¹ˆæ˜¯é”™è¯¯ä¼˜å…ˆçš„å›è°ƒå‡½æ•°ï¼Ÿ

```js
  é”™è¯¯ä¼˜å…ˆçš„å›è°ƒå‡½æ•°(Error-First Callback)ç”¨äºåŒæ—¶è¿”å›é”™è¯¯å’Œæ•°æ®ã€‚

  ç¬¬ä¸€ä¸ªå‚æ•°è¿”å›é”™è¯¯ï¼Œå¹¶ä¸”éªŒè¯å®ƒæ˜¯å¦å‡ºé”™ï¼›å…¶ä»–å‚æ•°ç”¨äºè¿”å›æ•°æ®ã€‚

  fs.readFile(filePath, function(err, data)
  {
      if (err)
      {
          // å¤„ç†é”™è¯¯
          return console.log(err);
      }
      console.log(data);
  });

```


> å¦‚ä½•é¿å…å›è°ƒåœ°ç‹±ï¼Ÿ

```
  ä»¥ä¸‹æ–¹å¼å¯ä»¥é¿å…å›è°ƒåœ°ç‹±:

    æ¨¡å—åŒ–: å°†å›è°ƒå‡½æ•°è½¬æ¢ä¸ºç‹¬ç«‹çš„å‡½æ•°

    ä½¿ç”¨æµç¨‹æ§åˆ¶åº“ï¼Œä¾‹å¦‚aync

    ä½¿ç”¨Promise

    ä½¿ç”¨aync/await
```


> ä»€ä¹ˆæ˜¯Stub?ä¸¾ä¾‹è¯´æ˜

```js
  Stubç”¨äºæ¨¡æ‹Ÿæ¨¡å—çš„è¡Œä¸ºã€‚æµ‹è¯•æ—¶ï¼ŒStubå¯ä»¥ä¸ºå‡½æ•°è°ƒç”¨è¿”å›æ¨¡æ‹Ÿçš„ç»“æœã€‚æ¯”å¦‚è¯´ï¼Œå½“æˆ‘ä»¬å†™æ–‡ä»¶æ—¶ï¼Œå®é™…ä¸Šå¹¶ä¸éœ€è¦çœŸæ­£å»å†™ã€‚
  
  var fs = require('fs');
  
  var writeFileStub = sinon.stub(fs, 'writeFile', function(path, data, cb)
  {
      return cb(null);
  });
  
  expect(writeFileStub).to.be.called;
  writeFileStub.restore();
```




> å¦‚ä½•ä¿è¯ä¾èµ–çš„å®‰å…¨æ€§ï¼Ÿ

```
  ç¼–å†™Node.jsåº”ç”¨æ—¶ï¼Œå¾ˆå¯èƒ½ä¾èµ–æˆç™¾ä¸Šåƒçš„æ¨¡å—ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨äº†Expressçš„è¯ï¼Œä¼šç›´æ¥ä¾èµ–27ä¸ªæ¨¡å—ã€‚

  å› æ­¤ï¼Œæ‰‹åŠ¨æ£€æŸ¥æ‰€æœ‰ä¾èµ–æ˜¯ä¸ç°å®çš„ã€‚å”¯ä¸€çš„åŠæ³•æ˜¯å¯¹ä¾èµ–è¿›è¡Œè‡ªåŠ¨åŒ–çš„å®‰å…¨æ£€æŸ¥ï¼Œæœ‰è¿™äº›å·¥å…·å¯ä¾›é€‰æ‹©:

  npm outdated
  
  Trace by RisingStack

  NSP
  
  GreenKeeper
  
  Snyk
```




> è¯·ç®€è¦è¯´æ˜module.exportsä¸exportsçš„å…³ç³»

```js
  module å’Œ exports éƒ½æ˜¯æ¨¡å—æ–‡ä»¶çš„ä¸Šä¸‹æ–‡ï¼Œæ›´ç¡®åˆ‡åœ°è®²ï¼Œæ¨¡å—æ–‡ä»¶çš„ä»£ç çœŸæ­£è¢«æ‰§è¡Œçš„æ˜¯è¢«åŒ…è£…è¿‡çš„ï¼Œæ¯”å¦‚ï¼š
  
  ä¸€æ—¦ require å‡½æ•°å‡†å¤‡å®Œæ¯•ï¼Œæ•´ä¸ªæ‰€è¦åŠ è½½çš„è„šæœ¬å†…å®¹ï¼Œå°±è¢«æ”¾åˆ°ä¸€ä¸ªæ–°çš„å‡½æ•°ä¹‹ä¸­ï¼Œè¿™æ ·å¯ä»¥é¿å…æ±¡æŸ“å…¨å±€ç¯å¢ƒã€‚è¯¥å‡½æ•°çš„å‚æ•°åŒ…æ‹¬ requireã€moduleã€exportsï¼Œä»¥åŠå…¶ä»–ä¸€äº›å‚æ•°ã€‚

  (function(exports, require, module, __filename, __dirname){//åŒ…è£…å¤´
    console.log("hello world!")//åŸå§‹æ–‡ä»¶å†…å®¹
  })//åŒ…è£…å°¾

  module å’Œ exports éƒ½æ˜¯æ¨¡å—è¢«æ‰§è¡Œæ—¶çš„å‚æ•°ã€‚å…¶ä¸­ exports ä¹Ÿæ˜¯ module çš„å±æ€§ï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜¯ä¸€ä¸ªç©ºå¯¹å¯¹è±¡ã€‚

  å½“ require ä¸€ä¸ªæ¨¡å—æ—¶ï¼Œå®é™…ä¸Šå¾—åˆ°çš„æ˜¯è¯¥æ¨¡å—çš„exportså±æ€§ã€‚

  åœ¨éreplæ¨¡å¼ä¸‹å¯ä»¥å¾—åˆ°éªŒè¯ï¼š

  console.log(module.exports === exports); //true

  console.log(exports); //{}
```




> es6 çš„exportã€import

```js
  export {name1,name2, â€¦,nameN};
  export {variable1asname1,variable2asname2, â€¦,nameN};
  export let name1,name2, â€¦,nameN; // also var
  export let name1= â€¦,name2= â€¦, â€¦,nameN; // also var, const

  export expression;
  export default expression;
  export default function (â€¦) { â€¦ } // also class, function*
  export default function name1(â€¦) { â€¦ } // also class, function*
  export {name1as default, â€¦ };

  export * from â€¦;
  export {name1,name2, â€¦,nameN} from â€¦;
  export {import1asname1,import2asname2, â€¦,nameN} from â€¦;

  import defaultMember from "module-name";
  import * as name from "module-name";
  import { member } from "module-name";
  import { member as alias } from "module-name";
  import { member1 , member2 } from "module-name";
  import { member1 , member2 as alias2 , [...] } from "module-name";
  import defaultMember, { member [ , [...] ] } from "module-name";
  import defaultMember, * as name from "module-name";
  import "module-name";
```



> Node.jsåœ¨æ‰§è¡Œ require(id) æ—¶æ˜¯æ€æ ·æ‰¾åˆ°ä¸€ä¸ªæ¨¡å—çš„ï¼Ÿï¼ˆ require åŠ è½½è§„åˆ™ ï¼‰

```
  Node.jsä¸­çš„require(id)æ‰§è¡Œåˆ†3ç§æƒ…å†µï¼šå¼•å…¥å†…å»ºæ¨¡å—ã€å¼•å…¥æ–‡ä»¶æ¨¡å—ã€å¼•å…¥ä¸€ä¸ªåŒ…ã€‚

  é€šè¿‡idå¯ä»¥åˆ†æå¾—åˆ°è¯¥æ¨¡å—æ˜¯ä¸€ä¸ªå†…å»ºæ¨¡å—ã€æ–‡ä»¶æ¨¡å—è¿˜æ˜¯åŒ…

  è‹¥æ˜¯å†…å»ºæ¨¡å—æ—¶ï¼Œç›´æ¥ä»å†…å­˜ä¸­åŠ è½½

  
  å½“idæ˜¯ç›¸å¯¹è·¯å¾„æˆ–ç»å¯¹è·¯å¾„æ—¶ï¼Œæ¨¡å—è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªæ–‡ä»¶æ¨¡å—ï¼Œé€šè¿‡æ–‡ä»¶æŸ¥æ‰¾å¯ä»¥å®šä½åˆ°æ–‡ä»¶çš„è·¯å¾„ã€‚


  å½“idæ—¢ä¸æ˜¯å†…å»ºæ¨¡å—ä¹Ÿä¸æ˜¯æ–‡ä»¶æ¨¡å—æ—¶ï¼Œåˆ™è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªåŒ…ã€‚è¿™ä¸ªåŒ…å¯èƒ½é€šè¿‡npmå®‰è£…çš„ç¬¬ä¸‰æ–¹æ¨¡å—ã€‚

  åŒ…çš„åŠ è½½æ–¹å¼ä¸ºï¼Œä»å½“å‰è·¯å¾„ä¸‹å¯»æ‰¾node_modeulesç›®å½•ä¸­æ˜¯å¦å­˜åœ¨è¯¥åŒ…ã€‚å¦‚æœæ²¡æœ‰ï¼Œæƒ³ä¸Šä¸€çº§ç›®å½•è¿›è¡ŒæŸ¥æ‰¾ï¼Œ

  çŸ¥é“æ ¹ç›®å½•ä¸‹çš„ node_modulesã€‚è¿™ä¸ªè§„åˆ™å¯ä»¥é€šè¿‡ module.paths å¾—åˆ°ã€‚


  å¯»æ‰¾åˆ°åŒ…åï¼Œå¯»æ‰¾åŒ…çš„æè¿°æ–‡ä»¶ pageage.json ï¼Œè¯¥æ–‡ä»¶çš„ main å­—æ®µè¡¨æ˜äº†è¿™ä¸ªåŒ…çš„å…¥å£æ–‡ä»¶ï¼Œ

  æ­¤æ—¶å†æŒ‰æ–‡ä»¶çš„æ–¹å¼æ‰¾åˆ°å¯¹åº”æ–‡ä»¶å³å¯ã€‚

  ï¼ˆç›®å‰è‡ªåŠ¨åŠ è½½æ‰©å±•åå¯çœç•¥ç±»å‹ .jsã€.jsonã€.node ï¼‰

  .nodeæ–‡ä»¶åœ¨ä¸åŒçš„å¹³å°ä¸‹å†…å®¹ä¸åŒï¼Œåœ¨Windowsä¸‹å…¶å®æ˜¯.dllæ–‡ä»¶ï¼Œå…¶ä»–å¹³å°ä¸‹æ˜¯.soæ–‡ä»¶
```





> èƒ½å¦ä½¿ç”¨require('.json')çš„æ–¹å¼åŠ è½½å¤§é‡çš„JSONæ–‡ä»¶ï¼Ÿ

```
  Node.js ä¸­æ¨å´‡éé˜»å¡ I/O ,ä½†æ˜¯ require ä¸€ä¸ªæ¨¡å—æ—¶ç¡®å®åŒæ­¥è°ƒç”¨çš„ï¼Œè¿™ä¼šå¸¦æ¥æ€§èƒ½ä¸Šçš„å¼€é”€ï¼Œä½†å¹¶ä¸æ˜¯æ¯æ¬¡ require éƒ½å¾ˆè€—æ—¶

  å› ä¸ºåœ¨ require æˆåŠŸä¹‹åä¼šç¼“å­˜èµ·æ¥ï¼Œå†æ¬¡åŠ è½½æ—¶ç›´æ¥ä»ç¼“å­˜è¯»å–ï¼Œå¹¶æ²¡æœ‰é¢å¤–å¼€é”€ã€‚

  å½“é€šè¿‡ .json çš„æ–¹å¼åŠ è½½æ–‡ä»¶æ—¶å›ºç„¶æ–¹ä¾¿ï¼Œä½†å¤§é‡ä½¿ç”¨æ—¶ä¼šå¯¼è‡´è¿™äº›æ•°æ®è¢«ç¼“å­˜ï¼Œå¤§é‡æ•°æ®é©»ç•™åœ¨å†…å­˜ä¸­ï¼Œå¯¼è‡´GCé¢‘ç¹å’Œå†…å­˜æ³„éœ²ã€‚
```




> Node.jsä¸­çš„å¼‚æ­¥I/Oæ˜¯å¦‚ä½•è¿›è¡Œçš„ï¼Ÿ

```
  Node.js çš„å¼‚æ­¥ I/O é€šè¿‡æ—¶é—´å¾ªç¯çš„æ–¹å¼å®ç°ã€‚å…¶ä¸­å¼‚æ­¥ I/O åˆåˆ† ç£ç›˜I/O å’Œ ç½‘ç»œI/Oã€‚

  åœ¨ç£ç›˜I/O çš„è°ƒç”¨ä¸­ï¼Œå½“å‘èµ·å¼‚æ­¥è°ƒç”¨åï¼Œä¼šå°†å¼‚æ­¥æ“ä½œé€è¿› libuv æä¾›çš„é˜Ÿåˆ—ä¸­ï¼Œç„¶åè¿”å›ã€‚

  åœ¨ç£ç›˜I/O æ‰§è¡Œå®Œæˆä¹‹åï¼Œä¼šå½¢æˆä¸€ä¸ªäº‹ä»¶ï¼Œäº‹ä»¶å¾ªç¯çš„è¿‡ç¨‹æ€»å‘ç°è¯¥äº‹ä»¶åï¼Œä¼šå°†å…¶æ¶ˆè´¹ã€‚

  æ¶ˆè´¹è¿‡ç¨‹å°±æ˜¯å°†å¾—åˆ°çš„æ•°æ®å’Œä¼ å…¥çš„å›è°ƒå‡½æ•°æ‰§è¡Œã€‚

  
  ç½‘ç»œI/O ä¸ ç£ç›˜I/O çš„å·®å¼‚åœ¨äºä»–ä¸éœ€è¦çº¿ç¨‹æ± æ¥è¿›è¡Œå¤„ç†ï¼Œè€Œæ˜¯åœ¨æ¯æ¬¡äº‹ä»¶å¾ªç¯çš„è¿‡ç¨‹ä¸­é€šè¿‡

  IOCP/epoll/kqueue/event portsæ¥è·å–ç½‘ç»œçš„I/Oçš„äº‹ä»¶é˜Ÿåˆ—ã€‚
```





> Nodeçš„å­è¿›ç¨‹æœ‰ä»€ä¹ˆåŸç†ï¼Ÿ

```
  Nodeçš„å­è¿›ç¨‹æ¨¡å—ä¸ºchild_processï¼Œç±»ä¼¼æ“ä½œç³»ç»Ÿçš„APIï¼Œä½†åˆæœ‰æ‰€ä¸åŒã€‚

  å­è¿›ç¨‹æ¨¡å—æœ‰execã€execFileã€forkã€spawn4ä¸ªå¼‚æ­¥æ–¹æ³•å’ŒexecSyncã€execFileSyncã€spawnSync3ä¸ªåŒæ­¥è°ƒç”¨æ–¹æ³•ã€‚

  child_processæ¨¡å—ä¸æ“ä½œç³»ç»Ÿåº•å±‚APIçš„åŒºåˆ«åœ¨äºå®ƒå¹¶ä¸æ˜¯ç”¨æ¥spawnå’Œforkå½“å‰è¿›ç¨‹çš„ï¼Œ

  é€šè¿‡è¿™äº›APIåˆ›å»ºå‡ºæ¥çš„å­è¿›ç¨‹ä¸çˆ¶è¿›ç¨‹ä¹‹é—´æ²¡æœ‰ä»»ä½•å¿…ç„¶çš„å…³ç³»ã€‚

  å½“åˆ›å»ºå‡ºæ¥çš„å­è¿›ç¨‹ä¹Ÿæ˜¯ä¸€ä¸ªnodeè¿›ç¨‹æ—¶ï¼Œå¯ä»¥åœ¨ä¸¤ä¸ªè¿›ç¨‹ä¹‹é—´é€šä¿¡ã€‚Nodeå†…å»ºäº†IPCæœºåˆ¶ï¼Œæš´éœ²çš„APIä¸ºchild.send()å’Œprocess.on('message')ã€‚

  å…¶å†…éƒ¨æœºåˆ¶åœ¨ä¸åŒçš„å¹³å°ä¸‹æœ‰ä¸åŒçš„å®ç°ï¼ŒUNIXä¸‹ä¸ºDomain Socketï¼ŒWindowsä¸ºNamed Pipeã€‚ 
```

> è¿›ç¨‹ï¼çº¿ç¨‹é—´çš„åŒæ­¥æœºåˆ¶æœ‰ï¼Ÿ


[è¯é¢˜ï¼š linux ä¸‹è¿›ç¨‹é—´çš„åŒæ­¥æœºåˆ¶æœ‰å“ªäº›ï¼Ÿ](https://www.zhihu.com/question/36529093)


> setTimeOut()

> process.nextTick()

> setImmediate();



> å¦‚ä½•å®ç°åœ¨çˆ¶è¿›ç¨‹é€€å‡ºæ—¶å­è¿›ç¨‹è·Ÿç€é€€å‡ºï¼Ÿ

```

```


> è¯·å†™ä¸€æ®µä»£ç  ï¼Œç¡®ä¿å¤šä¸ªè¿›ç¨‹åŒæ—¶å†™å…¥åŒä¸€ä¸ªæ–‡ä»¶æˆåŠŸ

```PHP
    function writeData($filepath, $data) 
    { 
        $fp = fopen($filepath,'a');  

        do{ 
            usleep(100); //å¾®ç§’
        }while (!flock($fp, LOCK_EX)); //å–å¾—ç‹¬å é”å®š 
        
        $res = fwrite($fp, $data."\n"); 

        flock($fp, LOCK_UN); //é‡Šæ”¾é”å®š
        
        fclose($fp);  
        
        return $res; 
    } 
```


> å®ç°ä¸€ä¸ªèƒ½å¤Ÿè‡ªåŠ¨é‡å¯çš„HTTPæœåŠ¡é›†ç¾¤ï¼Ÿ

```

```



> Clusteræ˜¯ä»€ä¹ˆåŸç†ï¼Ÿ

```
  Nodeçš„ cluster æ¨¡å—ç”¨äºè§£å†³Nodeå•è¿›ç¨‹æ— æ³•å……åˆ†åˆ©ç”¨æ“ä½œç³»ç»Ÿå¤šæ ¸CPUçš„é—®é¢˜ã€‚å¦å¤–ï¼Œé€šè¿‡master-clusteræ¨¡å¼ï¼Œ

  ä¹Ÿå¯ä»¥ä½¿å¾—Nodeåº”ç”¨çš„å¥å£®æ€§èƒ½å¾—åˆ°ä¿éšœã€‚

  Clusterçš„åº•å±‚æ˜¯child_processæ¨¡å—ï¼ŒNodeè¿›ç¨‹é—´é€šä¿¡é™¤äº†å¯ä»¥å‘é€æ™®é€šçš„æ¶ˆæ¯å¤–ï¼Œè¿˜çº¦å®šèƒ½å¤Ÿå‘é€åº•å±‚å¯¹è±¡ï¼ŒåŒ…æ‹¬TCPã€UCPç­‰ã€‚

  å½“ä¸€ä¸ªTCPé“¾æ¥ä»ä¸»è¿›ç¨‹å‘é€åˆ°å­è¿›ç¨‹åï¼Œå­è¿›ç¨‹èƒ½å¤Ÿæ ¹æ®æ¶ˆæ¯é‡å»ºå‡ºTCPè¿æ¥ï¼Œè¿™æ · Cluster å¯ä»¥å†³å®šforkå‡ºé€‚åˆç¡¬ä»¶èµ„æºçš„

  å­è¿›ç¨‹æ•°ã€‚è¿™äº›å­è¿›ç¨‹èƒ½å¤Ÿé€šè¿‡IPCçš„æœºåˆ¶åˆ†äº«å¯¹åŒä¸€ä¸ªç«¯å£çš„ä¾¦å¬ï¼Œå¦å¤–ï¼Œé€šè¿‡å¯¹è¿›ç¨‹é—´é€šä¿¡ç®¡é“çš„å¤„ç†ï¼Œå¯ä»¥è‡ªåŠ¨å®Œæˆè¿›ç¨‹é€€å‡ºé‡å¯ç­‰
```



> ç¼–å†™ä¸€ä¸ªç®€å•çš„åŒ…ï¼Œè¦æ±‚èƒ½å¤Ÿé€šè¿‡npmè¿›è¡Œå‘å¸ƒï¼Œå‘å¸ƒæˆåŠŸï¼Œèƒ½åœ¨å¦ä¸€ä¸ªé¡¹ç›®ä¸­è¿›è¡Œè°ƒç”¨ã€‚

```

```


> å¦‚ä½•æ‹¼æ¥å¤šä¸ªBufferä¸ºä¸€ä¸ªBufferï¼Ÿ

```
  Buffer.concat(list[, totalLength]);

  list <Array> List of Buffer objects to concat

  totalLength <Number> Total length of the Buffers in the list when concatenated
  
  Return: <Buffer>
  
```



ğŸ‘‰ [å¦‚ä½•é€šè¿‡é¥¿äº†ä¹ˆ Node.js é¢è¯•](https://github.com/ElemeFE/node-interview)

